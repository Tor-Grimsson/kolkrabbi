# Claude Instructions for Kolkrabbi Project

## Project Overview
Kolkrabbi is a monorepo containing a portfolio and foundry website. The project uses a modern React stack with Sanity CMS for content management.

## Tech Stack
- **Framework**: React 19 with Vite 7
- **Styling**: Tailwind CSS 4
- **CMS**: Sanity Studio 4
- **Routing**: React Router DOM 7
- **Animations**: GSAP 3
- **Language**: 
  - **Web App** (`apps/web/`): JavaScript (JSX)
  - **Sanity Studio** (`apps/studio/`): TypeScript (TS)
  - **Font Viewer** (`packages/fontviewer/`): JavaScript (JS)
- **Package Manager**: npm with workspaces

## Project Structure
```
kolkrabbi/
├── apps/
│   ├── web/          # Main portfolio website (JavaScript/JSX)
│   └── studio/       # Sanity Studio CMS (TypeScript)
├── packages/
│   └── fontviewer/   # Font viewing package (JavaScript)
└── package.json
```

## Key Technologies & Libraries
- **@sanity/client**: Sanity API client for fetching content
- **@sanity/image-url**: Image URL builder for Sanity images
- **@portabletext/react**: Render Sanity Portable Text
- **opentype.js**: Font file parsing and manipulation (used in fontviewer package)
- **gsap**: Animation library with React integration
- **styled-components**: CSS-in-JS styling (legacy, prefer Tailwind)

## Development Commands
- `npm run dev` or `npm run dev:web` - Start web app dev server
- `npm run dev:studio` - Start Sanity Studio
- `npm run dev:fontviewer` - Start font viewer package
- `npm run build` - Build web app for production
- `npm run lint:web` - Lint web app

## Coding Guidelines

### General Principles
1. **Language choice depends on workspace**:
   - `apps/web/` → JavaScript (JSX)
   - `apps/studio/` → TypeScript (TS) for schemas and config
   - `packages/fontviewer/` → JavaScript (JS)
2. **Prefer functional components** with hooks over class components
3. **Use Tailwind CSS** for styling - avoid styled-components for new code
4. **Keep components small** and focused on single responsibilities
5. **Use workspace-aware commands** when working with specific apps/packages
6. **Name by what it IS**: Components are PascalCase regardless of folder location

### React Patterns
- Use React 19 features and conventions
- Leverage hooks: `useState`, `useEffect`, `useMemo`, `useCallback`
- Use `react-use` hooks when applicable for common patterns
- Keep side effects in `useEffect` with proper dependency arrays

### Styling Approach
- **Primary**: Tailwind CSS utility classes
- **Legacy**: styled-components exists in codebase but avoid for new components
- Use Tailwind's `@apply` directive sparingly, prefer utility classes
- Follow mobile-first responsive design patterns

### Sanity CMS Integration
- Use `@sanity/client` for data fetching in web app
- Use `@sanity/image-url` for responsive images
- Render rich text with `@portabletext/react`
- Keep Sanity queries in dedicated files or hooks
- Use GROQ query language for content fetching
- **Studio schemas** are in TypeScript (`apps/studio/`)
- **Web app queries** are in JavaScript (`apps/web/`)

### Animation Guidelines
- Use GSAP for complex animations
- Leverage `@gsap/react` for React-specific GSAP integration
- Consider performance - use `will-change` and GPU-accelerated properties
- Keep animations smooth and purposeful

### File Organization
- Keep components in logical folders by feature/domain
- Separate concerns: components, hooks, utils, types
- Use index files for clean imports
- Co-locate tests with components when applicable

### Naming Conventions

**The Golden Rule: Name by what it IS, not where it lives**

**PascalCase**
- **React components** (anywhere in the project): `UserProfile.jsx`, `NavigationBar.jsx`
- Component utils: `ClippedImage.jsx`, `RoundedCorners.jsx`, `ComingSoonCard.jsx`
- Classes: `class ImageBuilder {}`, `class ApiClient {}`
- Enums (if using): `enum PostStatus { Draft, Published }`

**camelCase**
- Variables: `const userName = 'John'`, `let isLoading = false`
- Functions (non-React): `function fetchPosts() {}`, `const handleClick = () => {}`
- Utility functions: `formatDate.js`, `parseResponse.js`
- Object properties: `{ firstName: 'John', createdAt: Date }`
- Hooks: `useUserData.js`, `useSanityClient.js`, `useGSAPAnimation.js`
- Non-component files: `sanityClient.js`, `constants.js`
- Folders: `hooks/`, `utils/`, `lib/`, `components/`, `features/`, `pages/`

**SCREAMING_SNAKE_CASE**
- Constants: `const API_BASE_URL = 'https://...'`
- Environment variables: `VITE_SANITY_PROJECT_ID`, `VITE_SANITY_DATASET`
- Global config: `const MAX_IMAGE_WIDTH = 1920`, `const ANIMATION_DURATION = 1000`

**kebab-case**
- URLs/routes: `/blog-posts`, `/portfolio-items`, `/about-us`
- CSS custom classes (if any): `.portfolio-grid`, `.hero-section`
- Data attributes: `data-test-id`, `data-sanity-id`
- Package folders: `apps/web`, `packages/fontviewer`

**Key Insight: Your `utils/` folder contains React components!**
- `utils/ClippedImage.jsx` ✅ PascalCase (it's a component)
- `utils/formatDate.js` ✅ camelCase (if it were a function utility)
- The folder name doesn't determine the file case - the content does

**Examples from Your Project:**
```javascript
// WEB APP (JavaScript/JSX)

// Component in components/ - PascalCase
// apps/web/components/PortfolioGrid.jsx
export const PortfolioGrid = ({ items }) => {
  return <div>...</div>
}

// Component in utils/ - Still PascalCase!
// apps/web/utils/ClippedImage.jsx
export const ClippedImage = ({ src, alt }) => {
  return <img src={src} alt={alt} />
}

// Hook - camelCase
// apps/web/hooks/useSanityPosts.js
export const useSanityPosts = () => {
  const [posts, setPosts] = useState([])
  return posts
}

// Utility function - camelCase
// apps/web/lib/imageUrlBuilder.js
export const buildImageUrl = (source) => {
  return builder.image(source).url()
}

// Constants - SCREAMING_SNAKE_CASE
// apps/web/lib/constants.js
export const SANITY_API_VERSION = '2024-01-01'
export const DEFAULT_IMAGE_WIDTH = 1200

// Sanity queries - camelCase
// apps/web/lib/queries.js
export const postsQuery = `*[_type == "post"]{ ... }`
```

```typescript
// SANITY STUDIO (TypeScript)

// Schema definition - camelCase file, exported type
// apps/studio/schemas/post.ts
import { defineType, defineField } from 'sanity'

export default defineType({
  name: 'post',
  title: 'Post',
  type: 'document',
  fields: [
    defineField({
      name: 'title',
      title: 'Title',
      type: 'string',
    }),
  ],
})
```

### JavaScript Best Practices (Web App)
- Use modern ES6+ features (arrow functions, destructuring, spread operator)
- Prefer `const` over `let`, avoid `var`
- Use PropTypes or JSDoc comments for type documentation when helpful
- Keep functions pure when possible

### TypeScript Best Practices (Sanity Studio)
- Define proper types for schema definitions
- Use Sanity's built-in types: `defineType`, `defineField`, `defineArrayMember`
- Export schema types for use in web app if needed
- Follow Sanity's schema conventions

### Performance Considerations
- Memoize expensive computations with `useMemo`
- Memoize callbacks passed to children with `useCallback`
- Lazy load routes and heavy components
- Optimize images through Sanity's image pipeline

## Common Patterns

### Fetching Sanity Content
```typescript
import { createClient } from '@sanity/client';

const client = createClient({
  projectId: 'your-project-id',
  dataset: 'production',
  useCdn: true,
  apiVersion: '2024-01-01'
});

const query = `*[_type == "post"]{ title, slug, body }`;
const posts = await client.fetch(query);
```

### Using Sanity Images
```typescript
import imageUrlBuilder from '@sanity/image-url';

const builder = imageUrlBuilder(client);
const urlFor = (source) => builder.image(source);

// In component
<img src={urlFor(image).width(800).url()} alt={alt} />
```

### GSAP Animation
```typescript
import { useGSAP } from '@gsap/react';
import gsap from 'gsap';

useGSAP(() => {
  gsap.to('.element', { 
    duration: 1, 
    x: 100,
    ease: 'power2.out'
  });
}, []);
```

## What NOT to Do
- ❌ Don't use class components for new code
- ❌ Don't add new styled-components - use Tailwind
- ❌ Don't bypass TypeScript with excessive `any` usage (in studio workspace)
- ❌ Don't fetch data in render - use effects or loaders
- ❌ Don't commit without linting
- ❌ Don't hardcode content - use Sanity CMS
- ❌ Don't use inline styles - use Tailwind utilities
- ❌ **NEVER push to git** - always ask the user to review and push manually

## Git Workflow
**CRITICAL: Claude must NEVER execute git push commands.**

When work is complete:
1. ✅ Claude can suggest staging files: `git add .` or specific files
2. ✅ Claude can suggest commit messages: `git commit -m "message"`
3. ❌ Claude must NEVER run `git push`
4. ✅ Instead, Claude should tell the user: "Ready to push! Please review the changes and run `git push` manually when you're satisfied."

**Why?** The user maintains full control over what gets pushed to the repository. Always treat git push as a manual, deliberate action that requires human review.

## Monorepo Considerations
- Changes in `packages/*` may affect multiple apps
- Test changes across all dependent workspaces
- Use workspace commands to target specific apps
- Shared dependencies live in root `package.json`

## When Helping
1. **Ask clarifying questions** if the workspace/app isn't specified
2. **Consider the monorepo structure** when suggesting file locations
3. **Use modern React 19 patterns** and latest library features
4. **Prefer Tailwind** over other styling solutions
5. **Keep Sanity integration** in mind for content-driven features
6. **Optimize for performance** - this is a portfolio/showcase site

## Additional Context
- This is a **portfolio and foundry website** - prioritize visual polish and performance
- The font viewer suggests custom typography is important to the project
- Sanity Studio allows non-technical content updates
- The project name "Kolkrabbi" is Icelandic (means "cancer/crab")
